const t=async n=>{const e=(await chrome.storage.sync.get("hubspotAccounts")).hubspotAccounts||[];console.log("All accounts from storage:",e);const o=e.find(c=>String(c.hubId)===String(n));return console.log("Matching account:",o),o&&(console.log("Access Token:",o.accessToken),console.log("Refresh Token:",o.refreshToken)),o||null},r=n=>{const s=n.match(/\/modules\/(\d+)/);return s?s[1]:null};if(window.location.href.startsWith("https://app.hubspot.com/design-manager/")){console.log("Design Manager page detected");const n=window.location.href.split("/design-manager/")[1].split("/")[0],s=r(window.location.href);s&&(console.log("Portal ID:",n),console.log("Module ID:",s),t(n).then(async e=>{if(e&&e.accessToken&&e.refreshToken){console.log("Found valid account with tokens");try{console.log("Sending message to background script");const o=await chrome.runtime.sendMessage({action:"getModuleInfo",moduleId:s,account:{hubId:e.hubId,accessToken:e.accessToken,refreshToken:e.refreshToken}});o.success?console.log("Module Info:",o.data):console.error("Failed to get module info:",o.error)}catch(o){console.error("Message passing failed:",o)}}else console.error("Account missing required tokens:",e)}))}
